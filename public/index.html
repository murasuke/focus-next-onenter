<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JS QR Code Reader</title>
    <meta name="description" content="move focus on enter event" />
  </head>
  <body>
    <form id="form">
      <table>
        <tr>
          <td>
            <input type="text" value="no tabindex" />
          </td>
          <td>
            
            <input type="text" tabindex="1" value="tabindex is 1" />
          </td>
        </tr>
        <tr>
          <td>            
            <input type="text" tabindex="0" value="tabindex is 0"/>
          </td>
          <td>
            <input type="text" tabindex="-1" value="tabindex is -1" />
          </td>
        </tr>
        <tr>
          <td>
            <input type="text" tabindex="-2" value="tabindex is -2"/>
          </td>
          <td>
            <input type="text" tabindex="3" value="tabindex is 3" />
          </td>
        </tr>
        <tr>
          <td>
            <input type="text" value="no tabindex" />
          </td>
          <td>
            <input type="text" tabindex="3" value="tabindex is 3" />
          </td>
        </tr>
        <tr>
          <td>
            <input type="button" tabindex="2" value="tabindex is 2"/>
          </td>
          <td>
            <input type="button" value="no tabindex" />
          </td>
        </tr>
      </table>
    </form>
    <pre>
      ①tabindex(1以上)の順に移動 ⇒ 最大まで行ったらtabindex未指定をDOM出現に移動 ⇒ URL入力欄に移動
      ②同じtabindexが複数ある場合はDOM出現順に移動
      ③tabindex=0は未指定と同じ
      ④tabindexがマイナスの項目にフォーカスがある場合、次項目はDOM出現順に移動可能な項目へ移動
      ⑤移動可能：tabindex指定なし、もしくは0以上
    </pre>
    <script>
        // NodeList of applicable inputs, select, button
        let NodesArray = document.querySelectorAll(`
                          #form input:not([disabled])[type]:not([type=\"hidden\"]),
                          #form select:not([disabled]),
                          #form button:not([disabled])[type=\"submit\"]
        `);
          
        let array = Array.prototype.slice.call(NodesArray);
        let sorted = array.sort((a,b) => {
          if(a.tabIndex && b.tabIndex) {
            const aIdx = parseInt(a.tabIndex);
            const bIdx = parseInt(b.tabIndex);
            if( aIdx < bIdx ) return -1;
            if( aIdx > bIdx ) return 1;
            return 0;
          }

          if(a.tabIndex && !b.tabIndex) {
            return -1;
          }
          if(!a.tabIndex && b.tabIndex) {
            return 1;
          }
          return 0;
        });

        // Spread the array to an object so we can load the next node without 
        // keeping track of indexes (barf)
        (NodesObject => {

          // Node and NextNode are Elements.
          // You can update and get data if you want
          Object.keys(NodesObject).forEach(i => (({ Node, NextNode }) => {

            // Break if we dont have a NextNode
            if (NextNode === false) return;


            Node.addEventListener('keypress', KeyboardEvent => {

              // Only continue if event.key was "Enter"
              if (KeyboardEvent.key !== "Enter") return;

              // Dont submit, thx
              KeyboardEvent.preventDefault();

              // Do the thing
              NextNode.focus();

              // Not all elements have a select method
              if (typeof NextNode.select === 'function') NextNode.select();
            });


          })({
            Node:     NodesObject[i],
            NextNode: NodesObject[(parseInt(i) + 1)] ?? false
          }));

        })({ ...sorted });
    </script>
      
  </body>
</html>